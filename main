from cinetica_secondo_ordine import *
from cinetica_serie_2_1 import *
from michaelis_menten import *
from cinetica_allosterica import *

t_inizio=0
t_fine=2.5
t_campioni=5000
time=np.linspace(t_inizio,t_fine,t_campioni)
NO=5.84e-7 #[mol/l] oppure [M]
k1=8e7     #[M^(-1)*s^(-1)]
sCG=2e-6   #[M]
k2=1.3     #[1/s]

#Esempio di reazione chimica con cinetica del secondo ordine, A+B->Prodotto
#Grafici delle concentrazione dei substrati e del prodotto
decadimento_NO=concentrazione_A(NO,sCG,k1,time)
decadimento_sCG=concentraziione_B(NO,sCG,k1,time)
#prodotto_cinetica_secondo_ordine=concentrazione_P(NO,sCG,k1,time)

plt.subplot(2,1,1)
plt.xlabel('time')
plt.ylabel('decadimento NO')
plt.plot(time,decadimento_NO)
plt.subplot(2,1,2)
plt.xlabel('time')
plt.ylabel('decadimento sCG')
plt.plot(time,decadimento_sCG)
plt.show()

#Invece noi stiamo considerando due reazioni chimiche in serie. La prima reazione ha una cinetica del secondo ordine, mentre la seconda ha una cinetica del primo ordine
#A+B->I->P
#Questa funzione vuole rappresentrare la concentrazione di I nel tempo
#Si ricava risolvendo l'equazione differenziale dI/dt=-k2*I+k1*A*B quindi una equazione differenziale lineare del primo ordine

concentrazione_prodotto_intermedio_I=prodotto_intermedio_serie_2_1(NO,sCG,k1,k2,t_inizio,t_fine,0,'RK45',time)
plt.xlabel('time')
plt.ylabel('concentrazione prodotto intermedio I, enzima non ancora attivo')
plt.plot(time, concentrazione_prodotto_intermedio_I)
plt.show()

#Per il bilancio di massa vale: P=A0+B0-A-B-I

concentrazione_prodotto_P=np.zeros(t_campioni)
for i in range(t_campioni):
    concentrazione_prodotto_P[i]=NO+sCG-decadimento_NO[i]-decadimento_sCG[i]-concentrazione_prodotto_intermedio_I[i]

plt.xlabel('time')
plt.ylabel('concentrazione prodotto P, enzima attivo')
plt.plot(time,concentrazione_prodotto_P)
plt.show()

#Una volta che l'enzima è attivato, trasformerà GTP in cGMP
#La reazione è: GTP->cGMP+diphosphate, quindi 1 mole di GTP diventa 1 mole di cGMP e 1 mole di diphosphate
#Una volta che il cGMP si è formato, la fosfodiesterasi di tipo 5 PDE5 utilizzerà questo cGMP come substrato per ottenere
#GMP, che è biologicamente inattivo. La reazione è: cGMP+H20->GMP, quindi 1 mole di cGMP da origine a 1 mole di GMP
#L'acqua ovviamente è presente in quantità molto elevate e la sua concentrazione non risente di questa reazione chimica

x=sp.Symbol('x')
t_inizio_reazione_enzima=t_inizio #[s]
t_fine_reazione_enzima=900 #[s]
tempo_reazione_enzima=np.linspace(t_inizio_reazione_enzima,t_fine_reazione_enzima,t_campioni)
concentrazione_enzima_sCG=concentrazione_prodotto_P[t_campioni-1] #[M]
kcat_sCG=28.7 #[1/s]
km_sCG=49.8e-6 #[M]
coefficienti_hill=np.array([1,1.2,1.4,1.6])
km_PDE5=6e-6
kcat_PDE5=2.28
concentrazione_enzima_PDE5=188e-9
concentrazione_GMP=np.zeros(t_campioni)
concentrazione_GTP=305e-6 #[M]
produzione_cGMP_da_GTP=np.zeros(t_campioni)
decadimento_GTP=np.zeros(t_campioni)
decadimento_GTP[0]=concentrazione_GTP
decadimento_cGMP=np.zeros(t_campioni)
velocita_formazione_cGMP=np.zeros(t_campioni)
velocita_formazione_GMP=np.zeros(t_campioni)
velocita_formazione_cGMP[0]=cinetica_michaelis_menten(kcat_sCG,concentrazione_enzima_sCG,km_sCG,concentrazione_GTP) #[M/s]
for i in range(1,len(tempo_reazione_enzima)):
    if decadimento_cGMP[i]<0.3e-6:
        coefficiente_hill=coefficienti_hill[0]
    elif decadimento_cGMP[i]>=0.3e-6 and decadimento_cGMP[i]<1e-6:
        coefficiente_hill=coefficienti_hill[1]
    elif decadimento_cGMP[i]>=1e-6 and decadimento_cGMP[i]<10e-6:
        coefficiente_hill=coefficienti_hill[2]
    elif decadimento_cGMP[i]>=10e-6:
        coefficiente_hill=coefficienti_hill[3]
    produzione_cGMP_unita_tempo=sp.integrate(velocita_formazione_cGMP[i-1],(x,tempo_reazione_enzima[i-1],tempo_reazione_enzima[i]))
    produzione_cGMP_da_GTP[i] = produzione_cGMP_unita_tempo + produzione_cGMP_da_GTP[i-1]
    decadimento_GTP[i] = concentrazione_GTP - produzione_cGMP_da_GTP[i]
    produzione_GMP_unita_tempo=sp.integrate(velocita_formazione_GMP[i-1],(x,tempo_reazione_enzima[i-1],tempo_reazione_enzima[i]))
    concentrazione_GMP[i]=produzione_GMP_unita_tempo+concentrazione_GMP[i-1]
    decadimento_cGMP[i]=produzione_cGMP_unita_tempo-produzione_GMP_unita_tempo+decadimento_cGMP[i-1]
    velocita_formazione_cGMP[i]=cinetica_michaelis_menten(kcat_sCG,concentrazione_enzima_sCG,km_sCG,decadimento_GTP[i])
    velocita_formazione_GMP[i]=cinetica_allosterica(kcat_PDE5,concentrazione_enzima_PDE5,km_PDE5,decadimento_cGMP[i],coefficiente_hill)

plt.subplot(3,1,3)
plt.xlabel('time')
plt.ylabel('produzione GMP')
plt.plot(tempo_reazione_enzima,concentrazione_GMP)
plt.subplot(3,1,1)
plt.xlabel('time')
plt.ylabel('consumo del GTP')
plt.plot(tempo_reazione_enzima,decadimento_GTP)
plt.subplot(3,1,2)
plt.xlabel('time')
plt.ylabel('variazione del cGMP')
plt.plot(tempo_reazione_enzima,decadimento_cGMP)
plt.show()
